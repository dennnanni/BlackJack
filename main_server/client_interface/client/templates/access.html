<!DOCTYPE html>
<html lang="it">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Registration / Login</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

	<div class="container mt-5">
		<div class="row justify-content-center">
			<div class="col-md-6">
				<div class="card shadow rounded-4">
					<div class="card-body p-4">
						<ul class="nav nav-tabs mb-4" id="authTabs" role="tablist">
							<li class="nav-item" role="presentation">
								<button class="nav-link {% if login %}active{% endif %}" id="login-tab" data-bs-toggle="tab"
									data-bs-target="#login" type="button" role="tab">Login</button>
							</li>
							<li class="nav-item" role="presentation">
								<button class="nav-link {% if register %}active{% endif %}" id="register-tab" data-bs-toggle="tab"
									data-bs-target="#register" type="button" role="tab">Register</button>
							</li>
						</ul>

						<div class="tab-content" id="authTabsContent">
							<!-- Login Tab -->
							<div class="tab-pane fade show active" id="login" role="tabpanel">
								<form id="loginForm">
									<div class="mb-3">
										<label for="loginUsername" class="form-label">Username</label>
										<input type="text" class="form-control" id="loginUsername" required>
									</div>
									<div class="mb-3">
										<label for="loginPassword" class="form-label">Password</label>
										<input type="password" class="form-control" id="loginPassword" required>
									</div>
									<button type="submit" class="btn btn-primary w-100">Log in</button>
								</form>
							</div>

							<!-- Register Tab -->
							<div class="tab-pane fade" id="register" role="tabpanel">
								<form id="registerForm">
									<div class="mb-3">
										<label for="registerUsername" class="form-label">Username</label>
										<input type="text" class="form-control" id="registerUsername" required>
									</div>
									<div class="mb-3">
										<label for="registerPassword" class="form-label">Password</label>
										<input type="password" class="form-control" id="registerPassword" required>
									</div>
									<div class="mb-3">
										<label for="registerConfirmPassword" class="form-label">Confirm password</label>
										<input type="password" class="form-control" id="registerConfirmPassword"
											required>
									</div>
									<button type="submit" class="btn btn-success w-100">Register</button>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>

	<script>
		socket = io();

		socket.on('connect', () => {
			console.log('Connected to server');
		});

		document.getElementById('loginForm').addEventListener('submit', function (e) {
			e.preventDefault();
			const username = document.getElementById('loginUsername').value;
			const password = document.getElementById('loginPassword').value;
			console.log('Login:', username, password);

			socket.emit('login', { username, password }, (response) => {
				if (response.success) {
					console.log('Login successful:', response);
					window.location.href = response.redirect;
				} else if (response.error === 'invalid_credentials') {
					alert('Invalid username or password.');
				} else {
					alert('Login error: ' + response.message);
				}
			});

		});

		document.getElementById('registerForm').addEventListener('submit', function (e) {
			e.preventDefault();
			const username = document.getElementById('registerUsername').value;
			const password = document.getElementById('registerPassword').value;
			const confirmPassword = document.getElementById('registerConfirmPassword').value;

			if (password !== confirmPassword) {
				alert('Passwords don\'t match.');
				return;
			}

			console.log('Registrazione:', username);


			socket.emit('register', { username, password }, (response) => {
				if (response.success) {
					alert('Registration successful!');
					window.location.href = response.redirect;
				} else if (response.error === 'username_taken') {
					alert('Username already taken.');
				} else {
					alert('Registration error: ' + response.message);
				}
			});
		});
	</script>
</body>

</html>